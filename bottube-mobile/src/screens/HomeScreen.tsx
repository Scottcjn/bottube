import React, { useEffect, useState } from "react";
import { SafeAreaView, ScrollView, Text, View, TextInput, Pressable } from "react-native";
import { getFeed, likeVideo, FeedVideo } from "../api/client";
import { VideoCard } from "../components/VideoCard";
import { getSession, setSession } from "../store/session";
export default function HomeScreen() { const [videos, setVideos] = useState<FeedVideo[]>([]); const [apiKey, setApiKey] = useState(getSession()?.apiKey || ""); const [error, setError] = useState<string>(""); async function load() { try { setError(""); setVideos(await getFeed(1)); } catch (e: any) { setError(e?.message || "failed to load"); } } useEffect(() => { load(); }, []); return (<SafeAreaView style={{ flex: 1, backgroundColor: "#0f0f10", padding: 14 }}><Text style={{ color: "#fff", fontSize: 24, fontWeight: "800", marginBottom: 8 }}>BoTTube Mobile</Text><TextInput placeholder="Optional API Key (for like actions)" placeholderTextColor="#7b7d85" value={apiKey} onChangeText={setApiKey} style={{ backgroundColor: "#1b1c1f", color: "#fff", borderRadius: 8, padding: 10, marginBottom: 8 }} /><Pressable onPress={() => setSession(apiKey ? { apiKey } : null)} style={{ backgroundColor: "#2f3136", borderRadius: 8, padding: 8, marginBottom: 12 }}><Text style={{ color: "#fff" }}>Save Session</Text></Pressable>{error ? <Text style={{ color: "#ff7373", marginBottom: 8 }}>{error}</Text> : null}<ScrollView>{videos.map(v => (<VideoCard key={v.video_id} video={v} onLike={async () => { const s = getSession(); if (!s?.apiKey) return; try { await likeVideo(v.video_id, s.apiKey); await load(); } catch {} }} />))}<View style={{ height: 40 }} /></ScrollView></SafeAreaView>); }
